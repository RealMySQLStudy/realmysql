---

잠금, 트랜잭션, 트랜잭션의 격리수준

트랜잭션 = 작업의 완전성을 보장

완벽하게 처리 or 실패시 원상태 복구

잠금은 동시성을 제어하기 위한 기능

트랜잭션은 데이터의 정합성을 보장하기 위한 기능

ex

하나의 회원 정보 레코드를 여러 커넥션에서 동시에 변경 → 잠금이 없다면 여러 커넥션에서 동시에 변경 가능 → 레코드의 값은 예측 불가

격리수준 : 하나의 트랜잭션 내에서 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지 결정하는 레벨 의미

# 5.1 트랜잭션

트랜잭션 지원 X → MyISAM

트랜잭션 지원 O → InnoDB

둘의 처리방식 차이

## 5.1.1 MySQL에서의 트랜잭션

- 트랜잭션 = 여러 개의 변경 작업을 수행하는 쿼리가 조합됐을 때만 의미 있는 개념 X
- 논리적인 작업 셋 자체가 100% 적용되거나 아무것도 적용되지 않아야 함을 보장해 주는 것

## 5.1.2 주의사항

# 5.2 MySQL 엔진의 잠금

## 5.2.1 글로벌 락

## 5.2.2 테이블 락

- 개별 테이블 단위로 설정되는 잠금

## 5.2.3 네임드 락

- 단순히 사용자가 지정한 문자열에 대해 획득하고 반납하는 잠금
- 자주 사용 X

## 5.2.4 메타데이터 락

- 데이터베이스 객체의 이름이나 구조를 변경하는 경우 획득하는 잠금
- 명시적으로 획득 해제 X
- 테이블의 이름을 변경하는 경우 자동으로 획득

# 5.3 InnoDB 스토리지 엔진 잠금

- 스토리지 엔진 내부에서 레코드 기반의 잠금 방식 탑재
- MyISAM보다 휠씬 뛰어난 도잇성 처리를 제공
- 이원화된 잠금 처리 탓에 엔진에서 사용되는 잠금에 대한 정보는 MySQL명령을 이용해 접근하기가 까다롭다.
- InnoDB의 잠금에 대한 모니터링 강화 → Performance Schema를 이용해 스토리지 엔진의 내부잠금에 대한 모니터링 방법도 추가

## 5.3.1 InnoDB 스토리지 엔진의 잠금

- 레코드 기반의 잠금 기능 제공
- 레코드와 레코드 사이의 간격을 잠그는 갭 락 존재

### 5.3.1.1 레코드 락

- 레코드 자체만을 잠그는 것
- 레코드 자체가 아니라 인덱스의 레코드를 잠근다.
- 인덱스가 없어도 내부적으로 자동 생성된 클러스터 인덱스를 이용해 잠금 설정

### 5.3.1.2 갭락

- 레코드와 바로 인접한 레코드 사이의 간격만을 잠그는 것
- 레코드와 레코드 사이의 간격에 새로운 레코드가 생성되는 것을 제어
- 넥스트 키 락의 일부로 사용

### 5.3.1.3 넥스트 키 락

- 레코드 락과 갭 락을 합쳐 놓은 형태의 잠금

### 5.3.1.4 자동 증가 락

- InnoDB 스토리지 엔진에서는 내부적으로 AUTO_INCREMENT 락 이라고 하는 테이블 수준의 잠금 사용
- INSERT나 REPLACE문장에서 AUTO_INCREMENNT값을 가져오는 순간만 락이 걸렸다가 즉시 해제
- AUTO_INCREMENT 락을 명시적으로 획득하고 해제하는 방법 없다
- 아주 짧은 시간동안 걸렸다가 해제되는 잠금이라 대부분의 경우 문제 X

## 5.3.2 인덱스와 잠금

- InnoDB의 잠금은 레코드를 잠그는 것이 아니라 인덱스를 잠그는 방식으로 처리
- 즉 변경해야할 레코드를 찾기 위해 검색한 인덱스의 레코드를 모두 락을 걸어야함

## 5.3.3 레코드 수준의 잠금 확인 및 해제

# 5.4 MySQL의 격리 수준

- 트랜잭션 격리 수준이란 여러 트랜잭션이 동시에 처리될 때 특정 트랜잭션이 다른 트랜잭션에서 변경하거나 조회하는 데이터를 볼 수 있게 허용할지 말지를 결정하는 것이다
- READ UNCOMMITTED(DIRTY READ) → 거의 사용 X
- READ COMMITTED
- REPEATABLE READ
- SERIALIZABLE → 동시성이 중요한 데이터베이스에서는 거의사용X
- 순서대로 뒤로 갈수록 데이터 격리 정도가 높아지며 동시 처리 성능도 떨어지는 것이 일반적
- SERIALIZABLE격리수준이 아니라면 크게 성능의 개선이나 저하는 발생 X

## 5.4.1 READ UNCOMMITTED

- 변경 내용이 커밋이나 롤백 여부에 상관없이 다른 트랜잭션에서 보인다.

## 5.4.2 READ COMMITTED

- 오라클 DBMS의 기본으로 사용되는 격리 수준
- 온라인 서비스에서 가장 많이 선택되는 격리 수준
- 더티리드 같은 현상 발생 X
- 커밋이 완료된 데이터만 다른 트랜잭션에서 조회가능

## 5.4.3 REPEATABLE READ

- MySQL의 InnoDB 스토리지 엔진에서 기본으로 사용되는 격리 수준
- 바이너리 로그를 가진 MySQL 서버에서는 최소 REPEATABLE READ 격리 수준 이상을 사용해야함

## 5.4.4 SERIALIZABLE

- 가장 단순한 격리 수준이면서 동시에 가장 엄격한 격리 수준이다.
- 동시처리 성능 떨어짐
